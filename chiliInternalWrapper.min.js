(()=>{var e,t,r,n,o,i,c,a;(t=e||(e={})).Call="call",t.Reply="reply",t.Syn="syn",t.SynAck="synAck",t.Ack="ack",(n=r||(r={})).Fulfilled="fulfilled",n.Rejected="rejected",(i=o||(o={})).ConnectionDestroyed="ConnectionDestroyed",i.ConnectionTimeout="ConnectionTimeout",i.NoIframeSrc="NoIframeSrc",(c||(c={})).DataCloneError="DataCloneError",(a||(a={})).Message="message";var d=(e,t)=>{const r=[];let n=!1;return{destroy(o){n||(n=!0,t(`${e}: Destroying connection`),r.forEach((e=>{e(o)})))},onDestroy(e){n?e():r.push(e)}}},s=e=>(...t)=>{e&&console.log("[Penpal]",...t)};const u=({name:e,message:t,stack:r})=>({name:e,message:t,stack:r}),l=e=>{const t=new Error;return Object.keys(e).forEach((r=>t[r]=e[r])),t};var g=(t,n,o)=>{const{localName:i,local:d,remote:s,originForSending:l,originForReceiving:g}=t;let w=!1;const h=t=>{if(t.source!==s||t.data.penpal!==e.Call)return;if("*"!==g&&t.origin!==g)return void o(`${i} received message from origin ${t.origin} which did not match expected origin ${g}`);const a=t.data,{methodName:d,args:h,id:S}=a;o(`${i}: Received ${d}() call`);const m=t=>n=>{if(o(`${i}: Sending ${d}() reply`),w)return void o(`${i}: Unable to send ${d}() reply due to destroyed connection`);const a={penpal:e.Reply,id:S,resolution:t,returnValue:n};t===r.Rejected&&n instanceof Error&&(a.returnValue=u(n),a.returnValueIsError=!0);try{s.postMessage(a,l)}catch(t){if(t.name===c.DataCloneError){const n={penpal:e.Reply,id:S,resolution:r.Rejected,returnValue:u(t),returnValueIsError:!0};s.postMessage(n,l)}throw t}};new Promise((e=>e(n[d].apply(n,h)))).then(m(r.Fulfilled),m(r.Rejected))};return d.addEventListener(a.Message,h),()=>{w=!0,d.removeEventListener(a.Message,h)}};let w=0;const h=e=>e?e.split("."):[],S=(e,t,r)=>{const n=h(t);return n.reduce(((e,t,o)=>(void 0===e[t]&&(e[t]={}),o===n.length-1&&(e[t]=r),e[t])),e),e},m=(e,t)=>{const r={};return Object.keys(e).forEach((n=>{const o=e[n],i=((e,t)=>{const r=h(t||"");return r.push(e),(e=>e.join("."))(r)})(n,t);"object"==typeof o&&Object.assign(r,m(o,i)),"function"==typeof o&&(r[i]=o)})),r},y=e=>{const t={};for(const r in e)S(t,r,e[r]);return t};var p=(t,n,i,c,d)=>{const{localName:s,local:u,remote:g,originForSending:h,originForReceiving:S}=n;let m=!1;d(`${s}: Connecting call sender`);const p=t=>(...n)=>{let i;d(`${s}: Sending ${t}() call`);try{g.closed&&(i=!0)}catch(e){i=!0}if(i&&c(),m){const e=new Error(`Unable to send ${t}() call due to destroyed connection`);throw e.code=o.ConnectionDestroyed,e}return new Promise(((o,i)=>{const c=++w,m=n=>{if(n.source!==g||n.data.penpal!==e.Reply||n.data.id!==c)return;if("*"!==S&&n.origin!==S)return void d(`${s} received message from origin ${n.origin} which did not match expected origin ${S}`);const w=n.data;d(`${s}: Received ${t}() reply`),u.removeEventListener(a.Message,m);let h=w.returnValue;w.returnValueIsError&&(h=l(h)),(w.resolution===r.Fulfilled?o:i)(h)};u.addEventListener(a.Message,m);const y={penpal:e.Call,id:c,methodName:t,args:n};g.postMessage(y,h)}))},v=i.reduce(((e,t)=>(e[t]=p(t),e)),{});return Object.assign(t,y(v)),()=>{m=!0}};var v=(e,t)=>{let r;return void 0!==e&&(r=window.setTimeout((()=>{const r=new Error(`Connection timed out after ${e}ms`);r.code=o.ConnectionTimeout,t(r)}),e)),()=>{clearTimeout(r)}},j=(t,r,n,o)=>{const{destroy:i,onDestroy:c}=n;return n=>{if(!(t instanceof RegExp?t.test(n.origin):"*"===t||t===n.origin))return void o(`Child: Handshake - Received SYN-ACK from origin ${n.origin} which did not match expected origin ${t}`);o("Child: Handshake - Received SYN-ACK, responding with ACK");const a="null"===n.origin?"*":n.origin,d={penpal:e.Ack,methodNames:Object.keys(r)};window.parent.postMessage(d,a);const s={localName:"Child",local:window,remote:window.parent,originForSending:a,originForReceiving:n.origin},u=g(s,r,o);c(u);const l={},w=p(l,s,n.data.methodNames,i,o);return c(w),l}};var b,O,f=(t={})=>{const{parentOrigin:r="*",methods:n={},timeout:o,debug:i=!1}=t,c=s(i),u=d("Child",c),{destroy:l,onDestroy:g}=u,w=m(n),h=j(r,w,u,c);return{promise:new Promise(((t,n)=>{const i=v(o,l),d=r=>{if((()=>{try{clearTimeout()}catch(e){return!1}return!0})()&&r.source===parent&&r.data&&r.data.penpal===e.SynAck){const e=h(r);e&&(window.removeEventListener(a.Message,d),i(),t(e))}};window.addEventListener(a.Message,d),(()=>{c("Child: Handshake - Sending SYN");const t={penpal:e.Syn},n=r instanceof RegExp?"*":r;window.parent.postMessage(t,n)})(),g((e=>{window.removeEventListener(a.Message,d),e&&n(e)}))})),destroy(){l()}}};function E(e){return{isOk:!0,isError:!1,ok:e,error:void 0}}function P(e){return{isOk:!1,isError:!0,ok:void 0,error:e}}(O=b||(b={}))[O.error=0]="error",O[O.ok=1]="ok";const C=setInterval((()=>{null!=window.editorObject&&null!=window.OnEditorEvent&&A()}),500);let k;const A=()=>{clearInterval(C),k=f({methods:{alert:$,getDirtyState:F,nextPage:N,previousPage:R,setSelectedPage:I,getSelectedPage:L,getSelectedPageName:M,getNumPages:D,removeListener:x,addListener:G,setProperty:H,setProperties:K,getObject:V,getObjects:T,executeFunction:Y,executeFunctions:U,getPageSnapshot:q,getFrameSnapshot:z,getFrameSubjectArea:B,setFrameSubjectArea:J,clearFrameSubjectArea:Q,getAssetSubjectInfo:W,setAssetSubjectInfo:X,clearAssetSubjectInfo:Z,setVariableIsLocked:_}}),window.OnEditorEvent=(e,t)=>{k.promise.then((r=>{r.handleEvents(e,t)}))}},$=(e,t)=>{try{return window.editorObject.Alert(e,t),E(void 0)}catch(e){return P(e.toString())}},F=()=>{try{return E(window.editorObject.GetDirtyState())}catch(e){return P(e.toString())}},N=()=>{try{return window.editorObject.NextPage(),E(void 0)}catch(e){return P(e.toString())}},R=()=>{try{return window.editorObject.PreviousPage(),E(void 0)}catch(e){return P(e.toString())}},I=e=>{try{return window.editorObject.SetSelectedPage(e),E(void 0)}catch(e){return P(e.toString())}},L=()=>{try{return E(window.editorObject.GetSelectedPage())}catch(e){return P(e.toString())}},M=()=>{try{return E(window.editorObject.GetSelectedPageName())}catch(e){return P(e.toString())}},D=()=>{try{return E(window.editorObject.GetNumPages())}catch(e){return P(e.toString())}},x=e=>{try{return window.editorObject.RemoveListener(e),E(void 0)}catch(e){return P(e.toString())}},G=e=>{try{return window.editorObject.AddListener(e),E(void 0)}catch(e){return P(e.toString())}},V=e=>{try{return E(window.editorObject.GetObject(e))}catch(e){return P(e.toString())}},T=e=>{try{return E(e.map((e=>window.editorObject.GetObject(e))))}catch(e){return P(e.toString())}},H=(e,t,r)=>{try{return window.editorObject.SetProperty(e,t,r),E(void 0)}catch(e){return P(e.toString())}},K=e=>{try{return e.map((({chiliPath:e,property:t,value:r})=>window.editorObject.SetProperty(e,t,r))),E(void 0)}catch(e){return P(e.toString())}},Y=(e,t,r)=>{try{return E(window.editorObject.ExecuteFunction(e,t,...r))}catch(e){return P(e.toString())}},U=e=>{try{return E(e.map((({chiliPath:e,functionName:t,params:r})=>window.editorObject.ExecuteFunction(e,t,...r))))}catch(e){return P(e.toString())}},q=(e,t,r,n,o,i)=>{try{return E(window.editorObject.GetPageSnapshot(e,t,r,n,o,i))}catch(e){return P(e.toString())}},z=(e,t,r)=>{try{return E(window.editorObject.GetFrameSnapshot(e,t,r))}catch(e){return P(e.toString())}},B=e=>{try{return E(window.editorObject.GetFrameSubjectArea(e))}catch(e){return P(e.toString())}},J=(e,t,r,n,o)=>{try{return window.editorObject.SetFrameSubjectArea(e,t,r,n,o),E(void 0)}catch(e){return P(e.toString())}},Q=e=>{try{return window.editorObject.ClearFrameSubjectArea(e),E(void 0)}catch(e){return P(e.toString())}},W=e=>{try{return E(window.editorObject.GetAssetSubjectInfo(e))}catch(e){return P(e.toString())}},X=(e,t,r,n,o,i,c)=>{try{return window.editorObject.SetAssetSubjectInfo(e,t,r,n,o,i,c),E(void 0)}catch(e){return P(e.toString())}},Z=e=>{try{return window.editorObject.ClearAssetSubjectInfo(e),E(void 0)}catch(e){return P(e.toString())}},_=(e,t)=>{try{return window.editorObject.SetVariableIsLocked(e,t),E(void 0)}catch(e){return P(e.toString())}}})();
//# sourceMappingURL=chiliInternalWrapper.min.js.map
